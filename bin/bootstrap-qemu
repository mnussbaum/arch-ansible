#! /bin/bash

set -o errexit
set -o nounset

source bin/_bootstrap.sh

parted --align optimal /dev/sda mklabel gpt
parted --align optimal /dev/sda mkpart primary fat32 1MiB 261MiB
parted --align optimal /dev/sda set 1 esp on
parted --align optimal /dev/sda name 1 "EFI"
parted --align optimal /dev/sda mkpart primary ext4 261MiB 773MiB
parted --align optimal /dev/sda name 2 "Grub"
parted --align optimal /dev/sda mkpart primary ext4 773MiB 100%
parted --align optimal /dev/sda name 3 '"Arch Root"'

hostname="qemu"
username="mnussbaum"
disk="/dev/sda"
ssid=""
wireless_card=""

bootstrap "$hostname" "$username" "$disk" "$ssid" "$wireless_card"

# After rebooting:
# sudo cp -r /root/arch-ansible ~/src
# hostnamectl set-hostname qemu # Don't know why this isn't sticking from initial setup
# cd ~/src/arch-ansible
# ./bin/ansible # This should succeed to the point of secret setup
# gpg --import ~/gpg-keys/private-key.asc
# gpg --import ~/gpg-keys/public-key.asc
# rm -rf ~/gpg-keys
# shutdown -r now # Amongst other reasons this activates gpg-agent
# ssh-add # Adds SSH key to gpg-agent
# cd ~/src/arch-ansible
# ./bin/ansible
