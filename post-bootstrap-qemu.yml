# vim:ft=yaml.ansible:
---
- hosts: all
  tasks:
    - set_fact:
        user_home_dir: "{{ root_dir_mnt }}/home/{{ user.name }}"
        gpg_key_dir: "{{ root_dir_mnt }}/home/{{ user.name }}/gpg-keys"
        ssh_key_dir: "{{ root_dir_mnt }}/home/{{ user.name }}/.ssh"

    - name: Install gpg keys
      copy:
        src: gpg-keys
        dest: "{{ gpg_key_dir }}"
        owner: "{{ user.name }}"
    - name: Set gpg key dir permisisons
      file:
        dest: "{{ gpg_key_dir }}"
        mode: "0600"
        recurse: true

    - name: Install ssh keys
      copy:
        src: ssh-keys/
        dest: "{{ ssh_key_dir }}"
        owner: "{{ user.name }}"
    - name: Set ssh key dir permisisons
      file:
        dest: "{{ ssh_key_dir }}"
        mode: "0600"
        recurse: true

    - name: Copy over arch-ansible repo
      copy:
        src: "{{ playbook_dir }}"
        dest: "{{ user_home_dir }}/src/arch-ansible"
        owner: "{{ user.name }}"
