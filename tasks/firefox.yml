# vim:ft=yaml.ansible:
---
- name: Firefox | Install packages
  package:
    state: present
    name:
      - firefox-nightly
      - firefox-color
      - firefox-ublock-origin
      - firefox-vim-vixen
      - freshplayerplugin
      - pepper-flash
      - google-talkplugin
  become: true

- name: Firefox | Make default profile
  command: firefox-nightly -CreateProfile "default /home/{{ user.name }}/.mozilla/firefox/default.profile"
  args:
    creates: "/home/{{ user.name }}/.mozilla/firefox/default.profile"
  become: true
  become_user: "{{ user.name }}"

- name: Firefox | Symlink extensions dir for nightly
  file:
    src: /usr/lib/firefox/browser/extensions
    path: "/home/{{ user.name }}/.mozilla/firefox/default.profile/extensions"
    force: true
    state: link

- name: Firefox | Configure firefox user.js
  template:
    dest: "/home/{{ user.name }}/.mozilla/firefox/default.profile/user.js"
    src: templates/firefox-user.js.j2
    owner: "{{ user.name }}"

- name: Firefox | Create chrome config dir
  file:
    path: "/home/{{ user.name }}/.mozilla/firefox/default.profile/chrome"
    state: directory
    owner: "{{ user.name }}"

- name: Firefox | Configure firefox userChrome.css
  template:
    dest: "/home/{{ user.name }}/.mozilla/firefox/default.profile/chrome/userChrome.css"
    src: templates/firefox-userChrome.css.j2
    owner: "{{ user.name }}"

- name: Firefox | Create vim-vixen plugin config dir
  file:
    path: "/home/{{ user.name }}/.mozilla/firefox/default.profile/browser-extension-data/vim-vixen@i-beam.org"
    state: directory
    owner: "{{ user.name }}"

- name: Firefox | Configure vim-vixen plugin
  copy:
    dest: "/home/{{ user.name }}/.mozilla/firefox/default.profile/browser-extension-data/vim-vixen@i-beam.org/storage.js"
    src: firefox-vim-vixen-settings.js
    owner: "{{ user.name }}"

- name: Firefox | Configure flash plugin
  copy:
    remote_src: true
    src: /usr/share/freshplayerplugin/freshwrapper.conf.example
    dest: "/home/{{ user.name }}/.config/freshwrapper.conf"
    force: no
    owner: "{{ user.name }}"

- name: Firefox | Enable hardware acceleration for flash plugin
  lineinfile:
    dest: "/home/{{ user.name }}/.config/freshwrapper.conf"
    regexp: "^enable_hwdec ="
    line: "enable_hwdec = 1"
